<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro" name="track">

  <!-- ===================== ARGOMENTI COMUNI ===================== -->
  <xacro:property name="wheel_mass" default="0.1"/>
  <xacro:property name="wheel_ixx" default="2.26562e-05"/>
  <xacro:property name="wheel_iyy" default="2.26562e-05"/>
  <xacro:property name="wheel_izz" default="1.15625e-05"/>
  <xacro:property name="wheel_mesh" default="file://$(find mulinex_description)/meshes//wheel.stl"/>

  
  <xacro:property name="body_mass" value="0.6"/>
  <xacro:property name="body_left_mesh" default="file://$(find mulinex_description)/meshes//body_left.stl"/>
  <xacro:property name="body_right_mesh" default="file://$(find mulinex_description)/meshes//body_right.stl"/>

  <!-- ===================== MACRO ===================== -->

  <!-- Macro RUOTA -->
  <xacro:macro name="wheel" params="name parent xyz rpy">
    <link name="${name}">
      <inertial>
        <origin xyz="0 0 -0.0225" rpy="0 0 0"/>
        <mass value="${wheel_mass}"/>
        <inertia ixx="${wheel_ixx}" ixy="0" ixz="0"
                 iyy="${wheel_iyy}" iyz="0" izz="${wheel_izz}"/>
      </inertial>
      <visual>
        <origin xyz="0 0 -0.045" rpy="-1.5708 -1.5708 0"/>
        <geometry>
          <mesh filename="${wheel_mesh}"/>
        </geometry>
        <material name="${name}_material">
          <color rgba="0.615686 0.811765 0.929412 1"/>
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 -0.045" rpy="-1.5708 -1.5708 0"/>
        <geometry>
          <mesh filename="${wheel_mesh}"/>
        </geometry>
      </collision>
    </link>

    <joint name="joint_${name}" type="continuous">
      <origin xyz="${xyz}" rpy="${rpy}"/>
      <parent link="${parent}"/>
      <child link="${name}"/>
      <axis xyz="0 0 1"/>
      <limit effort="10" velocity="100000"/>
    </joint>
  </xacro:macro>
  
  <!-- Macro CORPO LEFT -->
  <xacro:macro name="body_left" params="name parent xyz rpy">
    <joint name="${name}_ankle" type="revolute">
      <origin xyz="${xyz}" rpy="${rpy}"/>
      <parent link="${parent}"/>
      <child link="${name}"/>
      <axis xyz="1 0 0"/>
      <limit effort="10" velocity="10" lower="-3.14159" upper="3.14159"/>
    </joint>

    <link name="${name}">
      <inertial>
        <origin xyz="0.0238777 -0.00119624 -0.00412068" rpy="0 0 0"/>
        <mass value="${body_mass}"/>
        <inertia ixx="0.000408384" ixy="6.93353e-06" ixz="3.09979e-05"
                 iyy="0.000335218" iyz="-2.90084e-05" izz="0.000303698"/>
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 3.14159"/>
        <geometry>
          <mesh filename="${body_left_mesh}"/>
        </geometry>
        <material name="${name}_material">
          <color rgba="0.647059 0.647059 0.647059 1"/>
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 3.14159"/>
        <geometry>
          <mesh filename="${body_left_mesh}"/>
        </geometry>
      </collision>
    </link>
  </xacro:macro>

  <!-- Macro CORPO RIGHT -->
  <xacro:macro name="body_right" params="name parent xyz rpy">
    <joint name="${name}_ankle" type="revolute">
      <origin xyz="${xyz}" rpy="${rpy}"/>
      <parent link="${parent}"/>
      <child link="${name}"/>
      <axis xyz="1 0 0"/>
      <limit effort="10" velocity="10" lower="-3.14159" upper="3.14159"/>
    </joint>

    <link name="${name}">
      <inertial>
        <origin xyz="-0.0238777 0.00412068 -0.00119624" rpy="0 0 0"/>
        <mass value="${body_mass}"/>
        <inertia ixx="0.000408384" ixy="3.09979e-05" ixz="-6.93353e-06"
                 iyy="0.000303698" iyz="2.90084e-05" izz="0.000335218"/>
      </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="-1.5708 0 -3.14159"/>
        <geometry>
          <mesh filename="${body_right_mesh}"/>
        </geometry>
        <material name="${name}_material">
          <color rgba="0.647059 0.647059 0.647059 1"/>
        </material>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="-1.5708 0 -3.14159"/>
        <geometry>
          <mesh filename="${body_right_mesh}"/>
        </geometry>
      </collision>
    </link>
  </xacro:macro>

  <!-- ===================== INSTANZE CORPI & RUOTE ===================== -->

  <!-- LEFT_H -->
  <xacro:body_left name="body_left_H" parent="LH_UPPER_LEG"
                   xyz="-0.19 0.05 0" rpy="1.5708 0 1.5708"/>
  <xacro:wheel name="wheel_1_LEFT_H" parent="body_left_H" xyz="0 0.0484063 -0.0583795" rpy="-6.12323e-17 -1.5708 0"/>
  <xacro:wheel name="wheel_2_LEFT_H" parent="body_left_H" xyz="0 1.07779e-16 -0.0583795" rpy="-6.12323e-17 -1.5708 0"/>
  <xacro:wheel name="wheel_3_LEFT_H" parent="body_left_H" xyz="0 -0.0510313 -0.0583795" rpy="-6.12323e-17 -1.5708 0"/>
  <xacro:wheel name="wheel_4_LEFT_H" parent="body_left_H" xyz="0 -0.0766777 -0.0417374" rpy="-6.12323e-17 -1.5708 0"/>

  <!-- LEFT_F -->
  <xacro:body_left name="body_left_F" parent="LF_UPPER_LEG"
                   xyz="0.19 0.05 0" rpy="-1.5708 0 1.5708"/>
  <xacro:wheel name="wheel_1_LEFT_F" parent="body_left_F" xyz="0 0.0484063 -0.0583795" rpy="-6.12323e-17 -1.5708 0"/>
  <xacro:wheel name="wheel_2_LEFT_F" parent="body_left_F" xyz="0 1.07779e-16 -0.0583795" rpy="-6.12323e-17 -1.5708 0"/>
  <xacro:wheel name="wheel_3_LEFT_F" parent="body_left_F" xyz="0 -0.0510313 -0.0583795" rpy="-6.12323e-17 -1.5708 0"/>
  <xacro:wheel name="wheel_4_LEFT_F" parent="body_left_F" xyz="0 -0.0766777 -0.0417374" rpy="-6.12323e-17 -1.5708 0"/>

  <!-- RIGHT_F -->
  <xacro:body_right name="body_right_F" parent="RF_UPPER_LEG"
                    xyz="0.19 -0.05 0" rpy="3.14159 0 1.5708"/>
  <xacro:wheel name="wheel_1_RIGHT_F" parent="body_right_F" xyz="2.08167e-17 0.0583795 0.0484062" rpy="-1.5708 0.992087 -1.5708"/>
  <xacro:wheel name="wheel_2_RIGHT_F" parent="body_right_F" xyz="0 0.0583795 1.10544e-16" rpy="-1.5708 0.967866 -1.5708"/>
  <xacro:wheel name="wheel_3_RIGHT_F" parent="body_right_F" xyz="-2.08167e-17 0.0583795 -0.0510312" rpy="-1.5708 0.967866 -1.5708"/>
  <xacro:wheel name="wheel_4_RIGHT_F" parent="body_right_F" xyz="-3.46945e-17 0.0417374 -0.0766777" rpy="-1.5708 0.992087 -1.5708"/>

  <!-- RIGHT_H -->
  <xacro:body_right name="body_right_H" parent="RH_UPPER_LEG"
                    xyz="-0.19 -0.05 0" rpy="0 0 1.5708"/>
  <xacro:wheel name="wheel_1_RIGHT_H" parent="body_right_H" xyz="2.08167e-17 0.0583795 0.0484062" rpy="-1.5708 0.992087 -1.5708"/>
  <xacro:wheel name="wheel_2_RIGHT_H" parent="body_right_H" xyz="0 0.0583795 1.10544e-16" rpy="-1.5708 0.967866 -1.5708"/>
  <xacro:wheel name="wheel_3_RIGHT_H" parent="body_right_H" xyz="-2.08167e-17 0.0583795 -0.0510312" rpy="-1.5708 0.967866 -1.5708"/>
  <xacro:wheel name="wheel_4_RIGHT_H" parent="body_right_H" xyz="-3.46945e-17 0.0417374 -0.0766777" rpy="-1.5708 0.992087 -1.5708"/>

</robot>
